# versaDeploy Configuration Example
# This file defines how and where your application is deployed.

# Unique project identifier (used for organizing logs and releases)
project: "my-awesome-app"

environments:
  # You can define multiple environments like 'production', 'staging', etc.
  production:
    ssh:
      host: "1.2.3.4"          # Server IP or hostname
      user: "deploy"           # SSH user
      key_path: "~/.ssh/id_rsa"# Path to private key (supports ~/ on Linux/macOS)
      port: 22                 # SSH port (default 22)

    # Absolute path on the server where the project will live
    remote_path: "/var/www/my-project"

    # BUILD ENGINES: versaDeploy can build your app locally before uploading
    builds:
      # PHP / Composer Settings
      php:
        enabled: true
        project_root: ""       # Subdirectory where composer.json is (optional)
        composer_command: "composer install --no-dev --optimize-autoloader"
        # Folders to reuse from previous release via hardlinks (speeds up deploy)
        reusable_paths: ["vendor"]

      # Frontend / Node Settings
      frontend:
        enabled: true
        project_root: "frontend" # Example of building in a subdirectory
        npm_command: "pnpm install"
        compile_command: "pnpm run build"
        cleanup_dev_deps: true   # Remove node_modules after build and reinstall prod-only
        production_command: "pnpm install --prod"
        reusable_paths: ["node_modules", "dist"]

    # PERSISTENCE: Folders that should survive between releases
    shared_paths:
      - "storage/logs"         # Log files
      - "public/uploads"       # User uploaded content
      - ".env"                 # Environment configuration

    # IMMUTABILITY: Files that should NOT be updated after the first deploy
    preserved_paths:
      - ".env"
      - "config.php"

    # HOOKS: Commands run on the server AFTER upload but BEFORE switching to the new version
    # They run in the context of the 'app' directory of the new release.
    post_deploy:
      - "php versaCLI migrate:up"
      - "php versaCLI cache:clear"

    # LIMITS:
    hook_timeout: 300          # Kill hooks if they take more than 5 minutes

# FILES TO IGNORE: These patterns won't be included in the deployment artifact.
# Note: versaDeploy is smart. If you ignore 'src' but a '.php' file inside changes,
# it will still detect the change to trigger a build!
ignored:
  - ".git"
  - ".github"
  - "node_modules"
  - "vendor"
  - "tests"
  - ".env"
  - "README.md"
  - "deploy.yml"
